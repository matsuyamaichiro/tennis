<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>YouTubeãƒ†ãƒ‹ã‚¹å‹•ç”»ã‚¹ã‚³ã‚¢å­—å¹•ä½œæˆã‚¢ãƒ—ãƒª</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
    label { font-size: inherit; }
    button { margin: 2px; background-color: #333; border-radius: 30px;
             color: #fff; padding: 5px 10px; cursor: pointer; }
    button:hover { background-color: #555; }

    /* å¼·èª¿ãƒœã‚¿ãƒ³ */
    .action-primary { background-color: #007bff; font-size: 1.1em;
      padding: 10px 20px; border-radius: 25px; margin: 8px 4px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: background-color .2s; }
    .action-primary:hover { background-color: #0056b3; }

    /* åŠ ç®—ãƒœã‚¿ãƒ³ */
    .plus{ background-color:#007bff;font-size:1.2em;padding:8px 14px;border:none;
           border-radius:20px;color:#fff;cursor:pointer; }
    .plus:hover{ background-color:#0056b3; }

    .scores{ font-size:1.2em;padding:5px; }
    .score-buttons{ display:flex; align-items:center; gap:12px; }

    input[type="text"]{ font-size:1.4em; padding:6px 10px; width:100%; box-sizing:border-box; }
    input[type="radio"]{ transform:scale(1.5); margin:8px; cursor:pointer; }

    #player{ width:100%; height:auto; }          /* é«˜ã•ã¯ JS ã§éƒ½åº¦è¨­å®š */
    #player iframe{ width:100%; height:100%; display:block; border:none; }

  </style>
</head>
<body>
  <h1>YouTubeãƒ†ãƒ‹ã‚¹å‹•ç”»ã‚¹ã‚³ã‚¢å­—å¹•ä½œæˆã‚¢ãƒ—ãƒª</h1>

  <!-- å‹•ç”»URLå…¥åŠ› -->
  <label>YouTubeå‹•ç”»URL:
    <input type="text" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=...">
  </label>
  <button id="loadBtn">å‹•ç”»èª­ã¿è¾¼ã¿</button><br><br>

  <!-- YouTubeãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ -->
  <div id="player"></div><br>

  <!-- ä»¥é™ï¼šã‚¹ã‚³ã‚¢å…¥åŠ›UIï¼ˆçœç•¥ã›ãšã«æ²è¼‰ï¼‰ -->
  <table>
    <tr><th></th><th>Player 1</th><th>Player 2</th></tr>

    <tr>
      <td>åå‰</td>
      <td><input type="text" id="player1" value="Player 1"></td>
      <td><input type="text" id="player2" value="Player 2"></td>
      <td></td>
    </tr>

    <tr>
      <td>ã‚µãƒ¼ãƒ–æ¨©</td>
      <td><input type="radio" name="server" id="serveP1" value="p1" checked></td>
      <td><input type="radio" name="server" id="serveP2" value="p2"></td>
      <td></td>
   </tr>

    <!-- ã‚²ãƒ¼ãƒ æ•° -->
    <tr>
      <td>ã‚²ãƒ¼ãƒ æ•°</td>
      <td>
        <div class="score-buttons">
          <span class="scores" id="p1Game">0</span>
          <button class="plus" onclick="adjustGame('p1',1)">ï¼‹</button>
          <button onclick="adjustGame('p1',-1)">âˆ’</button>
        </div>
      </td>
      <td>
        <div class="score-buttons">
          <span class="scores" id="p2Game">0</span>
          <button class="plus" onclick="adjustGame('p2',1)">ï¼‹</button>
          <button onclick="adjustGame('p2',-1)">âˆ’</button>
        </div>
      </td>
      <td></td>
    </tr>

    <!-- ãƒã‚¤ãƒ³ãƒˆ -->
    <tr>
      <td>ãƒã‚¤ãƒ³ãƒˆ</td>
      <td>
        <div class="score-buttons">
          <span class="scores" id="p1Point">0</span>
          <button class="plus" onclick="adjustPoint('p1',1)">ï¼‹</button>
          <button onclick="adjustPoint('p1',-1)">âˆ’</button>
        </div>
      </td>
      <td>
        <div class="score-buttons">
          <span class="scores" id="p2Point">0</span>
          <button class="plus" onclick="adjustPoint('p2',1)">ï¼‹</button>
          <button onclick="adjustPoint('p2',-1)">âˆ’</button>
        </div>
      </td>
      <td>
        <input type="checkbox" id="tiebreakMode"> ã‚¿ã‚¤ãƒ–ãƒ¬ãƒ¼ã‚¯
      </td>
    </tr>
  </table><br>

  <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
  <label><input type="checkbox" id="autoSubtitle" checked>ã‚²ãƒ¼ãƒ æ•°/ãƒã‚¤ãƒ³ãƒˆå¤‰æ›´æ™‚ã«å­—å¹•è¿½åŠ </label><br>
  <label><input type="checkbox" id="autoSwitchServe" checked>ã‚²ãƒ¼ãƒ æ•°å¤‰æ›´æ™‚ã«ã‚µãƒ¼ãƒ–æ¨©åˆ‡æ›¿ã¨ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ</label><br><br>

  <!-- ãƒªã‚»ãƒƒãƒˆç³» -->
  <button onclick="resetGames()">ã‚²ãƒ¼ãƒ æ•°ãƒªã‚»ãƒƒãƒˆï¼ˆä¸¡Playerï¼‰</button>
  <button onclick="resetPoints()">ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆï¼ˆä¸¡Playerï¼‰</button><br><br>

  <!-- å­—å¹•ç”Ÿæˆ -->
  <button class="action-primary" onclick="addSubtitle()">å­—å¹•ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <button onclick="addSubtitleOff()">å­—å¹•ã‚ªãƒ•</button><br><br>

  <!-- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->
  <button class="action-primary" onclick="downloadVTT()">å­—å¹•(VTT)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button><br><br>

  <input type="file" id="vttFileInput" accept=".vtt">
  <button onclick="loadVTTFile()">å­—å¹•(VTT)ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿</button>

  <div id="studioLinkContainer" style="margin-top:10px;"></div>

  <h2>å­—å¹•ãƒªã‚¹ãƒˆï¼ˆæ™‚åˆ»é †ï¼‰</h2>
  <ul id="subtitleList"></ul>

  <h2>ç”Ÿæˆã•ã‚ŒãŸå­—å¹•ãƒ‡ãƒ¼ã‚¿</h2>
  <textarea id="vttOutput" rows="12" readonly style="width:100%;"></textarea>

  <hr>
  <h2>ã“ã®ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹</h2>
  <ol>
    <li>YouTubeã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ†ãƒ‹ã‚¹å‹•ç”»ã®URLã‚’å…¥åŠ›ã—ã¦ã€Œå‹•ç”»èª­ã¿è¾¼ã¿ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</li>
    <li>Player1ã¨Player2ã®åå‰ï¼ˆãƒ€ãƒ–ãƒ«ã‚¹ãªã‚‰"éŒ¦ç¹”ãƒ»è¥¿å²¡"ã®ã‚ˆã†ã«ï¼’äººåˆ†ï¼‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
    <li>æœ€åˆã«ã‚µãƒ¼ãƒ–æ¨©ã‚’æŒã¤Playerã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚</li>
    <li>è©¦åˆé–‹å§‹æ™‚ã«0-0ã®çŠ¶æ…‹ã§ã€Œå­—å¹•ã‚¹ã‚¿ãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€æœ€åˆã®å­—å¹•ã‚’è¿½åŠ ã—ã¾ã™ã€‚</li>
    <li>å‹•ç”»ã‚’å†ç”Ÿãƒ»ä¸€æ™‚åœæ­¢ã—ãªãŒã‚‰ã€ãƒã‚¤ãƒ³ãƒˆæ•°ã‚’ã€Œ+ã€ã€Œâˆ’ã€ãƒœã‚¿ãƒ³ã§åŠ æ¸›ã™ã‚‹ã¨å­—å¹•ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚</li>
    <li>ã‚¿ã‚¤ãƒ–ãƒ¬ãƒ¼ã‚¯ã®ã‚²ãƒ¼ãƒ ã¯ã€äºˆã‚ã‚¿ã‚¤ãƒ–ãƒ¬ãƒ¼ã‚¯ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚ªãƒ³ã«ã—ã¦ä¸‹ã•ã„ã€‚</li>
    <li>ã‚²ãƒ¼ãƒ ã‚’ã€Œ+ã€ã€Œ-ã€ãƒœã‚¿ãƒ³ã§åŠ æ¸›ã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒ–æ¨©ãŒå…¥ã‚Œæ›¿ã‚ã‚Šã€ãƒã‚¤ãƒ³ãƒˆãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã€å­—å¹•ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚</li>
    <li>ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ãªã©ã€å­—å¹•ã‚’æ¶ˆã—ãŸã„å ´åˆã¯ã€Œå­—å¹•ã‚ªãƒ•ã€ãƒœã‚¿ãƒ³ã§å­—å¹•ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã€‚</li>
    <li>å‹•ç”»å†…ã§åˆ¥ã®è©¦åˆã«åˆ‡ã‚Šæ›¿ã‚ã‚‹å ´åˆã€ã€Œã‚²ãƒ¼ãƒ æ•°ãƒªã‚»ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã¨ã€Œãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€Playerã®åå‰æŒ‡å®šã‹ã‚‰å†åº¦å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚</li>
    <li>æœ€å¾Œã«ã€Œå­—å¹•(VTT)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã§ .vtt ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ã€‚</li>
    <li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ .vtt ãƒ•ã‚¡ã‚¤ãƒ«ã‚’YouTube Studioã§å‹•ç”»ã«å­—å¹•ã¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</li>
  </ol>
  <ul>
    <li>å­—å¹•ãƒªã‚¹ãƒˆã§ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æ™‚åˆ»â‡’Player1â‡’Player2ã®é †ã§å­—å¹•å†…å®¹ã‚’ç·¨é›†ã§ãã¾ã™ã€‚</li>
    <li>å­—å¹•ãƒªã‚¹ãƒˆã§ã€Œå‰Šé™¤ã€ãƒœã‚¿ãƒ³ã«ã‚ˆã‚Šã€å‰Šé™¤ã‚‚å¯èƒ½ã§ã™ã€‚</li>
    <li>ç¾åœ¨ã®ã‚²ãƒ¼ãƒ æ•°ã‚„ãƒã‚¤ãƒ³ãƒˆã‚’ä¿®æ­£ã™ã‚‹ã¨ãã¯ã€ã€Œã‚²ãƒ¼ãƒ æ•°/ãƒã‚¤ãƒ³ãƒˆå¤‰æ›´æ™‚ã«å­—å¹•è¿½åŠ ã€ã‚„ã€Œã‚²ãƒ¼ãƒ æ•°å¤‰æ›´æ™‚ã«ã‚µãƒ¼ãƒ–æ¨©åˆ‡ã‚Šæ›¿ãˆã¨ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆã€ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ä¸€æ—¦OFFã«ã—ã¦ä¸‹ã•ã„ã€‚</li>
    <li>.vttãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ç·¨é›†ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚é€”ä¸­ã‹ã‚‰å†é–‹ã™ã‚‹ã¨ãã«ä¾¿åˆ©ã‹ã‚‚ã€‚</li>
    <li>YouTube Studioã§å­—å¹•ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã®ã¯ã€å‹•ç”»ä½œæˆè€…ã®ã¿ã§ã™ã€‚</li>
    <li>ã“ã®ã‚¢ãƒ—ãƒªã®åˆ©ç”¨ã«ã‚ˆã£ã¦ç”Ÿã˜ãŸæå®³ç­‰ã®è²¬ä»»ã¯è² ã„ã¾ã›ã‚“ã€‚</li>
  </ul>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // ---------- å¤‰æ•° ----------
    let player = null;
    const pointsOrder = ['0','15','30','40','Adv'];
    let [p1Game, p2Game, p1Point, p2Point] = [0,0,0,0];
    let isTiebreak = false;
    let subtitles = [];

    // ---------- YouTube APIåˆæœŸåŒ– ----------
    function onYouTubeIframeAPIReady(){
      document.getElementById('loadBtn').onclick = () => {
        const inputURL = document.getElementById('youtubeUrl').value.trim();
        const vid = extractVideoId(inputURL);
        if(!vid){ alert('æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
        if(!player) createPlayer(vid);
        else        player.loadVideoById(vid);
        resizePlayer(); // ç”Ÿæˆç›´å¾Œã‚‚ã‚µã‚¤ã‚ºèª¿æ•´
        // Studioãƒªãƒ³ã‚¯
        document.getElementById('studioLinkContainer').innerHTML =
          `<a href="https://studio.youtube.com/video/${vid}/edit" target="_blank" rel="noopener noreferrer">
             ğŸ¬ ã“ã®å‹•ç”»ã®YouTube Studioãƒšãƒ¼ã‚¸ï¼ˆå­—å¹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
           </a>`;
      };

      document.getElementById('tiebreakMode').onchange = e => {
        isTiebreak = e.target.checked;
        refreshPointDisplays();
      };
    }

    // ---------- ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ç”Ÿæˆ ----------
    function createPlayer(videoId){
      player = new YT.Player('player',{
        videoId,
        events:{ onReady: resizePlayer } // APIãŒreadyã«ãªã£ãŸã‚‰ãƒªã‚µã‚¤ã‚º
      });
    }

    // ---------- ãƒªã‚µã‚¤ã‚ºå…±é€šå‡¦ç† ----------
    function resizePlayer(){
      if(!player || !player.setSize) return;
      const w = window.innerWidth;
      let   h = Math.round(w * 9/16);
      if(h > window.innerHeight){ h = window.innerHeight; } // ã¯ã¿å‡ºã—é˜²æ­¢
      player.setSize(w, h);
      document.getElementById('player').style.height = h + 'px';
    }

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºãƒ»ç«¯æœ«å›è»¢ãƒ»åˆå›ãƒ­ãƒ¼ãƒ‰
    ['resize','orientationchange','load'].forEach(ev =>
      window.addEventListener(ev, resizePlayer));

    // ---------- URLã‹ã‚‰videoIdæŠ½å‡º ----------
    function extractVideoId(url){
      try{
        const u = new URL(url);
        if(u.hostname === 'youtu.be')      return u.pathname.slice(1);
        if(u.hostname.includes('youtube')) return u.searchParams.get('v');
      }catch(e){ }
      return null;
    }

    // ---------- ã‚¹ã‚³ã‚¢æ“ä½œï¼ˆadjustGame / adjustPoint ãªã©æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã®ã¾ã¾ï¼‰ ----------
    function adjustGame(key,delta){
      if(key==='p1'){ p1Game=Math.max(0,p1Game+delta); document.getElementById('p1Game').textContent=p1Game; }
      else          { p2Game=Math.max(0,p2Game+delta); document.getElementById('p2Game').textContent=p2Game; }

      if(document.getElementById('autoSwitchServe').checked){
        p1Point=p2Point=0;
        document.getElementById('p1Point').textContent=pointsOrder[p1Point];
        document.getElementById('p2Point').textContent=pointsOrder[p2Point];
        toggleServe();
      }
      if(document.getElementById('autoSubtitle').checked) addSubtitle();
    }

    function adjustPoint(key,delta){
      if(isTiebreak){
        if(key==='p1'){ p1Point = Math.max(0,p1Point+delta);
                        document.getElementById('p1Point').textContent=p1Point; }
        else          { p2Point = Math.max(0,p2Point+delta);
                        document.getElementById('p2Point').textContent=p2Point; }
      } else {
        if(key==='p1'){ p1Point=(p1Point+delta+pointsOrder.length)%pointsOrder.length;
                        document.getElementById('p1Point').textContent=pointsOrder[p1Point]; }
        else          { p2Point=(p2Point+delta+pointsOrder.length)%pointsOrder.length;
                        document.getElementById('p2Point').textContent=pointsOrder[p2Point]; }
      }
      if(document.getElementById('autoSubtitle').checked) addSubtitle();
    }

    function resetGames() {
      p1Game = 0;
      p2Game = 0;
      document.getElementById('p1Game').textContent = p1Game;
      document.getElementById('p2Game').textContent = p2Game;
    }

    function resetPoints() {
      p1Point = 0;
      p2Point = 0;
      refreshPointDisplays();
    }

    function refreshPointDisplays() {
      if (isTiebreak) {
        // ã‚¿ã‚¤ãƒ–ãƒ¬ãƒ¼ã‚¯ä¸­ã¯ç”Ÿã®æ•°å­—ã‚’è¡¨ç¤º
        document.getElementById('p1Point').textContent = String(p1Point);
        document.getElementById('p2Point').textContent = String(p2Point);
      } else {
        // é€šå¸¸æ™‚ã¯ 0 / 15 / 30 / 40 / Adv è¡¨ç¤º
        document.getElementById('p1Point').textContent = pointsOrder[p1Point];
        document.getElementById('p2Point').textContent = pointsOrder[p2Point];
      }
    }

    function toggleServe() {
      const serveP1 = document.getElementById('serveP1');
      const serveP2 = document.getElementById('serveP2');
      if (serveP1.checked) {
          serveP1.checked = false;
          serveP2.checked = true;
      } else {
          serveP1.checked = true;
          serveP2.checked = false;
      }
    }

    function addSubtitle() {
      if (!player) { alert('å‹•ç”»ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“'); return; }
      const time = player.getCurrentTime();

      let p1Name = document.getElementById('player1').value || 'Player 1';
      let p2Name = document.getElementById('player2').value || 'Player 2';

      if (document.getElementById('serveP1').checked) {
        p1Name = '*' + p1Name;
      } else {
        p2Name = '*' + p2Name;
      }

      const p1Pt = isTiebreak ? String(p1Point) : pointsOrder[p1Point];
      const p2Pt = isTiebreak ? String(p2Point) : pointsOrder[p2Point];

      const line1 = `${p1Name}: ${p1Game} ${p1Pt}`;
      const line2 = `${p2Name}: ${p2Game} ${p2Pt}`;

      subtitles.push({ time, line1, line2 });
      updateSubtitleList();
      updateVTT();
    }

    function updateSubtitleList() {
      const list = document.getElementById('subtitleList');
      list.innerHTML = '';

      subtitles.sort((a,b)=>a.time - b.time);
      subtitles.forEach((s, index) => {
        const li = document.createElement('li');
        let displayLine = (s.line1 || s.line2) ? `"${s.line1} / ${s.line2}"` : 'å­—å¹•ã‚ªãƒ•';
        li.textContent = `${index + 1}: ${formatTime(s.time)} - ${displayLine}`;

        const editBtn = document.createElement('button');
        editBtn.textContent = 'ç·¨é›†';
        editBtn.onclick = () => editSubtitle(index);

        const delBtn = document.createElement('button');
        delBtn.textContent = 'å‰Šé™¤';
        delBtn.onclick = () => { subtitles.splice(index,1); updateSubtitleList(); updateVTT(); };

        li.appendChild(editBtn);
        li.appendChild(delBtn);
        list.appendChild(li);
      });
    }

    function editSubtitle(index) {
      const newTime = prompt('æ–°ã—ã„æ™‚é–“ï¼ˆç§’ï¼‰', subtitles[index].time);
      if (newTime !== null && !isNaN(newTime)) {
        subtitles[index].time = parseFloat(newTime);
        const newLine1 = prompt('1è¡Œç›®ã®ãƒ†ã‚­ã‚¹ãƒˆ', subtitles[index].line1);
        const newLine2 = prompt('2è¡Œç›®ã®ãƒ†ã‚­ã‚¹ãƒˆ', subtitles[index].line2);
        if (newLine1 !== null) subtitles[index].line1 = newLine1;
        if (newLine2 !== null) subtitles[index].line2 = newLine2;
        updateSubtitleList();
        updateVTT();
      }
    }

    function updateVTT() {
      let vtt = "WEBVTT\n\n";
      subtitles.sort((a,b)=>a.time-b.time).forEach((s, i) => {
        const start = formatTime(s.time);
        const end = (i+1 < subtitles.length) ? formatTime(subtitles[i+1].time) : "99:59:59.999";
        vtt += `${i+1}\n${start} --> ${end}\n${s.line1}\n${s.line2}\n\n`;
      });
      document.getElementById('vttOutput').value = vtt;
    }

    function formatTime(seconds) {
      const date = new Date(0);
      date.setSeconds(seconds);
      const hh = String(date.getUTCHours()).padStart(2,'0');
      const mm = String(date.getUTCMinutes()).padStart(2,'0');
      const ss = String(date.getUTCSeconds()).padStart(2,'0');
      const ms = String(Math.floor((seconds % 1) * 1000)).padStart(3,'0');
      return `${hh}:${mm}:${ss}.${ms}`;
    }

    function downloadVTT() {
      const vtt = document.getElementById('vttOutput').value;
      const blob = new Blob([vtt], { type: "text/vtt" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "tennis_score.vtt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadVTTFile() {
      const fileInput = document.getElementById('vttFileInput');
      const file = fileInput.files[0];
      if (!file) { alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }

      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        parseVTT(text);
      };
      reader.readAsText(file);
    }

    function parseVTT(vttText) {
      subtitles = []; // æ—¢å­˜ãƒªã‚¹ãƒˆåˆæœŸåŒ–
      const blocks = vttText.split(/\n\n+/);
      for (const block of blocks) {
        const lines = block.trim().split('\n');
        if (lines.length >= 3 && lines[1].includes('-->')) {
          const timeStr = lines[1].split(' --> ')[0];
          const timeSec = parseTime(timeStr);
          const line1 = lines[2];
          const line2 = lines[3] || '';
          subtitles.push({ time: timeSec, line1, line2 });
        }
      }
      updateSubtitleList();
      updateVTT();
    }

    function parseTime(timeStr) {
      const [hh, mm, ssMs] = timeStr.split(':');
      const [ss, ms] = ssMs.split('.');
      return Number(hh) * 3600 + Number(mm) * 60 + Number(ss) + Number(ms) / 1000;
    }

    function addSubtitleOff() {
      if (!player) { alert('å‹•ç”»ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“'); return; }
      const time = player.getCurrentTime();
      subtitles.push({ time, line1: '', line2: '' });
      updateSubtitleList();
      updateVTT();
    }

  </script>
</body>
</html>
